# Bug Fixes and Issues

## af8_error.pdf - Appearance Stream Parsing Error

### Issue
When running the `simple_fill` example on `af8_error.pdf`, the following error occurred:

```
Error: Shared { source: FromPrimitive { typ: "Option < MaybeRef < AppearanceStreams > >", 
field: "appearance_streams", source: FromPrimitive { typ: "Ref < AppearanceStreamEntry >", 
field: "normal", source: UnexpectedPrimitive { expected: "Reference", found: "Dictionary" } } } }
```

### Root Cause
The `AppearanceStreams` struct in `pdf/src/object/types.rs` defined the `normal`, `rollover`, and `down` fields as `Ref<AppearanceStreamEntry>`, which only accepts indirect object references. However, according to the PDF specification (section 12.5.5), appearance streams can be either:
- Direct objects (embedded dictionaries)
- Indirect objects (referenced via object reference)

The `af8_error.pdf` file contains appearance streams as direct dictionary objects rather than indirect references, causing the parser to fail when it encountered a Dictionary primitive instead of a Reference.

### Solution
Changed the field types in `AppearanceStreams` from `Ref<AppearanceStreamEntry>` to `MaybeRef<AppearanceStreamEntry>`. The `MaybeRef<T>` type is an enum that can handle both:
- `Direct(Shared<T>)` - for direct objects embedded in the parent
- `Indirect(RcRef<T>)` - for indirect objects referenced by ID

This is consistent with how other similar fields are defined, such as `default_resources: Option<MaybeRef<Resources>>`.

### Changes Made
1. **pdf/src/object/types.rs**:
   - Changed `normal: Ref<AppearanceStreamEntry>` to `normal: MaybeRef<AppearanceStreamEntry>`
   - Changed `rollover: Option<Ref<AppearanceStreamEntry>>` to `rollover: Option<MaybeRef<AppearanceStreamEntry>>`
   - Changed `down: Option<Ref<AppearanceStreamEntry>>` to `down: Option<MaybeRef<AppearanceStreamEntry>>`
   - Added documentation explaining the rationale

2. **examples/src/bin/form.rs**:
   - Updated to use `MaybeRef` API:
     - Access data via dereference: `**a.normal`
     - Get reference for updates: `a.normal.as_ref()`

### Testing
- ✅ `simple_fill` example now successfully processes `af8_error.pdf`
- ✅ `in_memory_fill` example works correctly
- ✅ All existing tests pass (43 tests total)
- ✅ No regressions with other PDF files (`af8.pdf`, `af8_clean.pdf`)

### Impact
This fix allows the library to handle a wider variety of PDF files that use different encoding strategies for appearance streams, improving compatibility with PDF files generated by various tools.
